---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Section from "@/components/layout/Section.astro";
import Card from "@/components/ui/Card.astro";
import Badge from "@/components/ui/Badge.astro";
import PricingToggle from "@/components/marketing/PricingToggle";
import ComparisonMatrix from "@/components/marketing/ComparisonMatrix.astro";
import PricingFAQ from "@/components/marketing/PricingFAQ.astro";
import { t } from "@/i18n/utils";

const locale = "de";

// Tier data inline to avoid island serialization issues
const tiers = [
  { id: "solo", name: t("pricing.solo", locale), monthly: 99, annual: 89, queries: "~150–300/Monat", features: ["1 Platz", "1 Jurisdiktion", "Quellenangaben", "Konfidenzwertung", "Abfrageverlauf", "E-Mail-Support"] },
  { id: "team", name: t("pricing.team", locale), monthly: 299, annual: 269, queries: "~750–3.000/Monat", highlighted: true, features: ["4 Plätze", "1 Jurisdiktion", "Quellenangaben", "Konfidenzwertung", "Geteilter Workspace", "Mandantenordner", "Vorlagen", "Prioritäts-Support"] },
  { id: "firm", name: t("pricing.firm", locale), monthly: 549, annual: 494, queries: "~2.000–8.000/Monat", features: ["15 Plätze", "2 Jurisdiktionen", "Quellenangaben", "Konfidenzwertung", "Admin-Dashboard", "Wissensdatenbank", "Massenanalyse", "Audit-Trail", "SSO", "Dedizierter Support"] },
  { id: "enterprise", name: t("pricing.enterprise", locale), monthly: null, annual: null, queries: "Unbegrenzt", features: ["Unbegrenzte Plätze", "Alle Jurisdiktionen", "Alle Funktionen", "Individuelle Integrationen", "SLA", "Dedizierter Account Manager"] },
];
---

<BaseLayout
  title={`${t("pricing.title", locale)} — ${t("site.title", locale)}`}
  description={t("site.description", locale)}
  locale={locale}
  path="/pricing/"
>
  <main id="main-content">
    <Section class="pt-12 md:pt-16 pb-8">
      <div class="mx-auto max-w-3xl text-center">
        <h1 class="text-display text-foreground">{t("pricing.title", locale)}</h1>
        <p class="mt-4 text-body-lg text-muted-foreground">{t("pricing.subtitle", locale)}</p>
      </div>

      <div class="mt-8 flex justify-center">
        <PricingToggle
          client:load
          monthlyLabel={t("pricing.monthly", locale)}
          annualLabel={t("pricing.annual", locale)}
          annualSave={t("pricing.annual_save", locale)}
        />
      </div>

      {/* Billing explanation */}
      <div class="mx-auto max-w-3xl text-center">
        <p class="mt-2 text-body-xs text-muted-foreground">
          <strong>Monatlich:</strong> Jeden Monat zahlen, jederzeit kündbar &nbsp;|&nbsp; <strong>Jährlich:</strong> Vorauszahlung für 12 Monate, 10% sparen
        </p>
      </div>

      {/* Founding member offer */}
      <div class="mt-6 mx-auto max-w-2xl rounded-lg border border-primary/20 bg-primary/5 px-8 py-5 text-center">
        <p class="text-body font-semibold text-primary-text">Gründerpreise</p>
        <p class="mt-2 text-body-sm text-muted-foreground">
          Gründerpreise <strong class="text-foreground">für 1 Jahr garantiert</strong>. Begrenzte Verfügbarkeit.
        </p>
        <p class="mt-1 text-body-sm text-muted-foreground">
          Alle Preise sind <strong>pro Plan</strong> (nicht pro Platz).
        </p>
      </div>

      {/* Tier cards — UIX-05 */}
      <div class="mt-10 grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        {tiers.map((tier) => (
          <Card highlighted={tier.highlighted} class={tier.highlighted ? "shadow-lg" : ""}>
            <div class="flex flex-col h-full">
              <div class="mb-4">
                {tier.highlighted && (
                  <Badge class="mb-2">{t("pricing.most_popular", locale)}</Badge>
                )}
                <h3 class="text-body-lg font-semibold text-foreground">{tier.name}</h3>
              </div>

              {tier.monthly ? (
                <div class="mb-6">
                  <div class="flex items-baseline gap-1">
                    <span class="text-display-sm font-bold text-foreground">€<span data-price-monthly={tier.monthly} data-price-annual={tier.annual}>{tier.monthly}</span></span>
                    <span class="text-body-sm text-muted-foreground">/Monat</span>
                  </div>
                  <p class="text-body-xs text-muted-foreground mt-1">
                    <span data-billing-text data-billing-monthly={`€${tier.monthly} monatlich`} data-billing-annual={`€${tier.annual * 12}/Jahr (€${tier.annual}/Monat)`}>€{tier.monthly} monatlich</span>
                  </p>
                </div>
              ) : (
                <div class="mb-4">
                  <span class="text-display-sm font-bold text-foreground">{t("pricing.custom", locale)}</span>
                </div>
              )}

              <p class="mb-4 text-body-xs text-muted-foreground">{tier.queries} Abfragen</p>

              <ul class="mb-6 flex-1 space-y-2">
                {tier.features.map((f: string) => (
                  <li class="flex items-start text-body-sm text-muted-foreground">
                    <span class="mr-2 text-primary-text">✓</span>
                    {f}
                  </li>
                ))}
              </ul>

              <a
                href={tier.monthly ? `/${locale}/waitlist/?plan=${tier.id}` : `/${locale}/contact/`}
                class="inline-flex h-11 min-h-[44px] w-full items-center justify-center rounded-lg bg-primary px-6 text-body-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
              >
                {tier.monthly ? t("pricing.cta", locale) : t("pricing.enterprise_cta", locale)}
              </a>
            </div>
          </Card>
        ))}
      </div>
    </Section>

    {/* Jurisdiction add-ons — PRICE-03 */}
    <Section muted>
      <div class="text-center max-w-2xl mx-auto">
        <h2 class="text-h2 text-foreground">Jurisdiktionserweiterungen</h2>
        <p class="mt-2 text-body text-muted-foreground">Erweitern Sie die Abdeckung über Belgien hinaus</p>
      </div>
      <div class="mt-10 grid gap-8 sm:grid-cols-2 max-w-3xl mx-auto">
        <div class="rounded-xl border border-border bg-card/50 p-6 text-center">
          <div class="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
            </svg>
          </div>
          <h3 class="text-body-lg font-semibold text-foreground">Zusätzliche Jurisdiktionen</h3>
          <p class="mt-2 text-body-sm text-muted-foreground">Fügen Sie die Niederlande oder Luxemburg einzeln zu Ihrem Plan hinzu</p>
          <div class="mt-4 inline-flex items-center gap-1.5 rounded-full bg-primary/10 px-3 py-1 text-caption font-medium text-primary-text">
            <span class="relative flex h-2 w-2"><span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-primary opacity-75"></span><span class="relative inline-flex h-2 w-2 rounded-full bg-primary"></span></span>
            Demnächst
          </div>
        </div>
        <div class="rounded-xl border border-border bg-card/50 p-6 text-center">
          <div class="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
          </div>
          <h3 class="text-body-lg font-semibold text-foreground">Benelux-Paket</h3>
          <p class="mt-2 text-body-sm text-muted-foreground">Belgien + Niederlande + Luxemburg in einem Paket</p>
          <div class="mt-4 inline-flex items-center gap-1.5 rounded-full bg-primary/10 px-3 py-1 text-caption font-medium text-primary-text">
            <span class="relative flex h-2 w-2"><span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-primary opacity-75"></span><span class="relative inline-flex h-2 w-2 rounded-full bg-primary"></span></span>
            Demnächst
          </div>
        </div>
      </div>
    </Section>

    {/* Feature comparison matrix — PRICE-04 / UIX-05 */}
    <Section>
      <h2 class="text-h2 text-foreground">Funktionsvergleich</h2>
      <p class="mt-2 text-body text-muted-foreground">Sehen Sie, was in jedem Plan enthalten ist</p>
      <div class="mt-8">
        <ComparisonMatrix locale={locale} labels={{ solo: "Solo", team: "Team", firm: "Firm", enterprise: "Enterprise" }} />
      </div>
    </Section>

    {/* Pricing FAQ */}
    <Section muted>
      <h2 class="text-h2 text-foreground">Häufig gestellte Fragen</h2>
      <div class="mt-8 mx-auto max-w-3xl">
        <PricingFAQ faqs={[
          { question: "Sind die Preise pro Platz oder pro Plan?", answer: "Preise sind pro Plan, nicht pro Platz. Jeder Plan enthält eine bestimmte Anzahl Plätze (Solo: 1, Team: 4, Firm: 15). Sie zahlen nicht extra für jeden Nutzer innerhalb Ihres Limits." },
          { question: "Was ist der Unterschied zwischen monatlich und jährlich?", answer: "Monatliche Abrechnung belastet Ihre Karte jeden Monat und Sie können jederzeit kündigen. Jährliche Abrechnung belastet einmal im Voraus für 12 Monate mit 10% Rabatt. Beide zeigen den Monatspreis zum einfachen Vergleich." },
          { question: "Was sind Gründerpreise?", answer: "Gründerpreise sind für 1 Jahr ab Anmeldung garantiert. Begrenzte Verfügbarkeit — melden Sie sich für die Warteliste an, um Ihren Platz zu sichern." },
          { question: "Wann wird Auryth TX AI gestartet?", answer: "Wir befinden uns derzeit in der Pre-Launch-Phase. Melden Sie sich für die Warteliste an, um über den Start informiert zu werden und Gründerpreise zu sichern." },
          { question: "Gibt es eine kostenlose Testversion?", answer: "Ja. Jeder Plan enthält eine 14-tägige kostenlose Testversion mit vollem Zugang. Keine Kreditkarte erforderlich." },
          { question: "Kann ich später den Plan wechseln?", answer: "Selbstverständlich. Sie können jederzeit upgraden oder downgraden. Änderungen werden zum nächsten Abrechnungszyklus wirksam." },
          { question: "Welche Zahlungsmethoden akzeptieren Sie?", answer: "Zum Start akzeptieren wir alle gängigen Kreditkarten und SEPA-Lastschrift." },
          { question: "Sind meine Daten sicher?", answer: "Ja. Wir sind ein belgisches Unternehmen, das der DSGVO unterliegt. Ihre Daten werden innerhalb der EU verarbeitet und gespeichert. Details finden Sie in unserer Datenschutzerklärung." }
        ]} />
      </div>
    </Section>
  </main>

  {/* Billing toggle → price swap script */}
  <script is:inline>
    window.addEventListener("billing-toggle", function (e) {
      var isAnnual = e.detail.isAnnual;
      
      // Update prices
      document.querySelectorAll("[data-price-monthly]").forEach(function (el) {
        el.textContent = isAnnual ? el.dataset.priceAnnual : el.dataset.priceMonthly;
      });
      
      // Update billing text
      document.querySelectorAll("[data-billing-text]").forEach(function (el) {
        el.textContent = isAnnual ? el.dataset.billingAnnual : el.dataset.billingMonthly;
      });
    });
  </script>
</BaseLayout>
