---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Section from "@/components/layout/Section.astro";
import { getCollection } from "astro:content";
import { t } from "@/i18n/utils";

const locale = "en";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => data.locale === "en" && !data.draft);
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<BaseLayout
  title={`${post.data.title} â€” ${t("site.title", locale)}`}
  description={post.data.description}
  locale={locale}
  path={`/blog/${post.id}/`}
>
  <main>
    <Section class="py-24 md:py-32">
      <div class="mx-auto max-w-3xl">
        <a href={`/${locale}/blog/`} class="text-body-sm text-primary-text hover:underline">&larr; Back to blog</a>

        <header class="mt-8">
          <time class="text-caption text-muted-foreground" datetime={post.data.publishDate.toISOString()}>
            {post.data.publishDate.toLocaleDateString("en-GB", { year: "numeric", month: "long", day: "numeric" })}
          </time>
          <h1 class="mt-2 text-display text-foreground">{post.data.title}</h1>
          <p class="mt-4 text-body-lg text-muted-foreground">{post.data.description}</p>
          <div class="mt-4 flex flex-wrap gap-2">
            {post.data.tags.map((tag: string) => (
              <span class="rounded-full border border-border px-3 py-1 text-caption text-muted-foreground">{tag}</span>
            ))}
          </div>
          <p class="mt-4 text-body-sm text-muted-foreground">By {post.data.author}</p>
        </header>

        <article class="prose mt-12">
          <Content />
        </article>
      </div>
    </Section>
  </main>
</BaseLayout>
