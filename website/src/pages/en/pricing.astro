---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Section from "@/components/layout/Section.astro";
import Card from "@/components/ui/Card.astro";
import Badge from "@/components/ui/Badge.astro";
import PricingToggle from "@/components/marketing/PricingToggle";
import ComparisonMatrix from "@/components/marketing/ComparisonMatrix.astro";
import PricingFAQ from "@/components/marketing/PricingFAQ.astro";
import { t } from "@/i18n/utils";

const locale = "en";

// Tier data inline to avoid island serialization issues
const tiers = [
  { id: "solo", name: "Solo", monthly: 99, annual: 89, queries: "~150–300/mo", features: ["1 seat", "1 jurisdiction", "Source citations", "Confidence scoring", "Query history", "Email support"] },
  { id: "team", name: "Team", monthly: 299, annual: 269, queries: "~750–3,000/mo", highlighted: true, features: ["4 seats", "1 jurisdiction", "Source citations", "Confidence scoring", "Shared workspace", "Client folders", "Templates", "Priority support"] },
  { id: "firm", name: "Firm", monthly: 549, annual: 494, queries: "~2,000–8,000/mo", features: ["15 seats", "2 jurisdictions", "Source citations", "Confidence scoring", "Admin dashboard", "Knowledge base", "Bulk analysis", "Audit trail", "SSO", "Dedicated support"] },
  { id: "enterprise", name: "Enterprise", monthly: null, annual: null, queries: "Unlimited", features: ["Unlimited seats", "All jurisdictions", "All features", "Custom integrations", "SLA", "Dedicated account manager"] },
];
---

<BaseLayout
  title={`${t("pricing.title", locale)} — ${t("site.title", locale)}`}
  description={t("site.description", locale)}
  locale={locale}
  path="/pricing/"
>
  <main id="main-content">
    <Section class="pt-12 md:pt-16 pb-8">
      <div class="mx-auto max-w-3xl text-center">
        <h1 class="text-display text-foreground">{t("pricing.title", locale)}</h1>
        <p class="mt-4 text-body-lg text-muted-foreground">{t("pricing.subtitle", locale)}</p>
      </div>

      <div class="mt-8 flex justify-center">
        <PricingToggle
          client:load
          monthlyLabel={t("pricing.monthly", locale)}
          annualLabel={t("pricing.annual", locale)}
          annualSave={t("pricing.annual_save", locale)}
        />
      </div>

      {/* Billing explanation */}
      <div class="mx-auto max-w-3xl text-center">
        <p class="mt-2 text-body-xs text-muted-foreground">
          <strong>Monthly:</strong> Pay each month, cancel anytime &nbsp;|&nbsp; <strong>Annual:</strong> Pay upfront for 12 months, save 10%
        </p>
      </div>

      {/* Founding member offer */}
      <div class="mt-6 mx-auto max-w-2xl rounded-lg border border-primary/20 bg-primary/5 px-8 py-5 text-center">
        <p class="text-body font-semibold text-primary-text">Founding Tier Pricing</p>
        <p class="mt-2 text-body-sm text-muted-foreground">
          Founding tier pricing <strong class="text-foreground">guaranteed for 1 year</strong>. Limited availability.
        </p>
        <p class="mt-1 text-body-sm text-muted-foreground">
          All prices are <strong>per-plan</strong> (not per seat).
        </p>
      </div>

      {/* Tier cards — UIX-05 */}
      <div class="mt-10 grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        {tiers.map((tier) => (
          <Card highlighted={tier.highlighted} class={tier.highlighted ? "shadow-lg" : ""}>
            <div class="flex flex-col h-full">
              <div class="mb-4">
                {tier.highlighted && (
                  <Badge class="mb-2">{t("pricing.most_popular", locale)}</Badge>
                )}
                <h3 class="text-body-lg font-semibold text-foreground">{tier.name}</h3>
              </div>

              {tier.monthly ? (
                <div class="mb-6">
                  <div class="flex items-baseline gap-1">
                    <span class="text-display-sm font-bold text-foreground">€<span data-price-monthly={tier.monthly} data-price-annual={tier.annual}>{tier.monthly}</span></span>
                    <span class="text-body-sm text-muted-foreground">/mo</span>
                  </div>
                  <p class="text-body-xs text-muted-foreground mt-1">
                    <span data-billing-text data-billing-monthly={`€${tier.monthly} billed monthly`} data-billing-annual={`€${tier.annual * 12}/year (€${tier.annual}/mo)`}>€{tier.monthly} billed monthly</span>
                  </p>
                </div>
              ) : (
                <div class="mb-4">
                  <span class="text-display-sm font-bold text-foreground">{t("pricing.custom", locale)}</span>
                </div>
              )}

              <p class="mb-4 text-body-xs text-muted-foreground">{tier.queries} queries</p>

              <ul class="mb-6 flex-1 space-y-2">
                {tier.features.map((f: string) => (
                  <li class="flex items-start text-body-sm text-muted-foreground">
                    <span class="mr-2 text-primary-text">✓</span>
                    {f}
                  </li>
                ))}
              </ul>

              <a
                href={tier.monthly ? `/${locale}/waitlist/?plan=${tier.id}` : `/${locale}/contact/`}
                class="inline-flex h-11 min-h-[44px] w-full items-center justify-center rounded-lg bg-primary px-6 text-body-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
              >
                {tier.monthly ? t("pricing.cta", locale) : t("pricing.enterprise_cta", locale)}
              </a>
            </div>
          </Card>
        ))}
      </div>
    </Section>

    {/* Jurisdiction add-ons — PRICE-03 */}
    <Section muted>
      <div class="text-center max-w-2xl mx-auto">
        <h2 class="text-h2 text-foreground">Jurisdiction Add-ons</h2>
        <p class="mt-2 text-body text-muted-foreground">Extend coverage beyond Belgium</p>
      </div>
      <div class="mt-10 grid gap-8 sm:grid-cols-2 max-w-3xl mx-auto">
        <div class="rounded-xl border border-border bg-card/50 p-6 text-center">
          <div class="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
            </svg>
          </div>
          <h3 class="text-body-lg font-semibold text-foreground">Additional Jurisdictions</h3>
          <p class="mt-2 text-body-sm text-muted-foreground">Add Netherlands or Luxembourg individually to your plan</p>
          <div class="mt-4 inline-flex items-center gap-1.5 rounded-full bg-primary/10 px-3 py-1 text-caption font-medium text-primary-text">
            <span class="relative flex h-2 w-2"><span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-primary opacity-75"></span><span class="relative inline-flex h-2 w-2 rounded-full bg-primary"></span></span>
            Coming soon
          </div>
        </div>
        <div class="rounded-xl border border-border bg-card/50 p-6 text-center">
          <div class="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
          </div>
          <h3 class="text-body-lg font-semibold text-foreground">Benelux Bundle</h3>
          <p class="mt-2 text-body-sm text-muted-foreground">Belgium + Netherlands + Luxembourg in one package</p>
          <div class="mt-4 inline-flex items-center gap-1.5 rounded-full bg-primary/10 px-3 py-1 text-caption font-medium text-primary-text">
            <span class="relative flex h-2 w-2"><span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-primary opacity-75"></span><span class="relative inline-flex h-2 w-2 rounded-full bg-primary"></span></span>
            Coming soon
          </div>
        </div>
      </div>
    </Section>

    {/* Feature comparison matrix — PRICE-04 / UIX-05 */}
    <Section>
      <h2 class="text-h2 text-foreground">Feature Comparison</h2>
      <p class="mt-2 text-body text-muted-foreground">See what's included in each plan</p>
      <div class="mt-8">
        <ComparisonMatrix locale={locale} labels={{ solo: "Solo", team: "Team", firm: "Firm", enterprise: "Enterprise" }} />
      </div>
    </Section>

    {/* Pricing FAQ */}
    <Section muted>
      <h2 class="text-h2 text-foreground">Frequently Asked Questions</h2>
      <div class="mt-8 mx-auto max-w-3xl">
        <PricingFAQ faqs={[
          { question: "Are prices per seat or per plan?", answer: "Prices are per plan, not per seat. Each plan includes a set number of seats (Solo: 1, Team: 4, Firm: 15). You don't pay extra for each user within your seat limit." },
          { question: "What's the difference between monthly and annual?", answer: "Monthly billing charges your card each month and you can cancel anytime. Annual billing charges once upfront for 12 months at a 10% discount. Both options show the monthly-equivalent price for easy comparison." },
          { question: "What is Founding Tier pricing?", answer: "Founding tier pricing is guaranteed for 1 year from sign-up. Limited availability — join the waitlist to secure your spot." },
          { question: "When does Auryth TX AI launch?", answer: "We are currently in pre-launch. Join the waitlist to be notified when we launch and to secure founding tier pricing." },
          { question: "Is there a free trial?", answer: "Yes. Every plan includes a 14-day free trial with full access. No credit card required to start." },
          { question: "Can I change plans later?", answer: "Absolutely. You can upgrade or downgrade your plan at any time. Changes take effect at the next billing cycle." },
          { question: "What payment methods do you accept?", answer: "We will accept all major credit cards and SEPA direct debit at launch." },
          { question: "Is my data secure?", answer: "Yes. We are a Belgian company subject to GDPR. Your data is processed and stored within the EU. See our privacy policy for details." }
        ]} />
      </div>
    </Section>
  </main>

  {/* Billing toggle → price swap script */}
  <script is:inline>
    window.addEventListener("billing-toggle", function (e) {
      var isAnnual = e.detail.isAnnual;
      
      // Update prices
      document.querySelectorAll("[data-price-monthly]").forEach(function (el) {
        el.textContent = isAnnual ? el.dataset.priceAnnual : el.dataset.priceMonthly;
      });
      
      // Update billing text
      document.querySelectorAll("[data-billing-text]").forEach(function (el) {
        el.textContent = isAnnual ? el.dataset.billingAnnual : el.dataset.billingMonthly;
      });
    });
  </script>
</BaseLayout>
