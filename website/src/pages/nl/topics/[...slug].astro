---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Section from "@/components/layout/Section.astro";
import { getCollection, render } from "astro:content";
import { t } from "@/i18n/utils";

const locale = "nl";

export const prerender = true;

export async function getStaticPaths() {
  const topics = await getCollection("topics", ({ data }) => data.locale === "nl");
  return topics.map((topic) => ({
    params: { slug: topic.id.replace(/\.mdx?$|\.md$/, "") },
    props: { topic },
  }));
}

const { topic } = Astro.props;
const { Content } = await render(topic);

const slug = topic.id.replace(/\.mdx?$|\.md$/, "");
const topicUrl = `https://auryth.ai/${locale}/topics/${slug}/`;

const articleSchema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": topic.data.title,
  "description": topic.data.description,
  "author": { "@type": "Organization", "name": "Auryth BV" },
  "publisher": { "@type": "Organization", "name": "Auryth BV", "url": "https://auryth.ai" },
  "mainEntityOfPage": topicUrl,
  ...(topic.data.sources.length > 0 ? {
    "citation": topic.data.sources.map((s) => ({
      "@type": "CreativeWork",
      "name": s.title,
      "url": s.url,
    }))
  } : {}),
});

const breadcrumbSchema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": `https://auryth.ai/${locale}/` },
    { "@type": "ListItem", "position": 2, "name": "Onderwerpen", "item": `https://auryth.ai/${locale}/topics/` },
    { "@type": "ListItem", "position": 3, "name": topic.data.title, "item": topicUrl },
  ],
});
---

<BaseLayout
  title={`${topic.data.title} â€” ${t("site.title", locale)}`}
  description={topic.data.description}
  locale={locale}
  path={`/topics/${slug}/`}
>
  <Fragment slot="head">
    <script is:inline type="application/ld+json" set:html={articleSchema} />
    <script is:inline type="application/ld+json" set:html={breadcrumbSchema} />
  </Fragment>

  <main id="main-content">
    <Section class="pt-12 md:pt-16">
      <div class="mx-auto max-w-3xl">
        <a href={`/${locale}/topics/`} class="text-body-sm text-primary-text hover:underline">&larr; Alle onderwerpen</a>

        <header class="mt-8">
          <span class="text-overline text-primary-text">{topic.data.template.replace(/-/g, " ")}</span>
          <h1 class="mt-2 text-display text-foreground">{topic.data.title}</h1>
          <p class="mt-4 text-body-lg text-muted-foreground">{topic.data.description}</p>
        </header>

        <article class="prose mt-12">
          <Content />
        </article>

        {topic.data.sources.length > 0 && (
          <aside class="mt-12 rounded-lg border border-border bg-card p-6">
            <h2 class="text-body-lg font-semibold text-foreground">Bronnen</h2>
            <ul class="mt-4 space-y-2">
              {topic.data.sources.map((source) => (
                <li class="text-body-sm">
                  <a href={source.url} target="_blank" rel="noopener noreferrer" class="text-primary-text hover:underline">
                    {source.title}
                  </a>
                </li>
              ))}
            </ul>
          </aside>
        )}

        {topic.data.relatedGuide && (
          <div class="mt-8">
            <a href={`/${locale}/guides/${topic.data.relatedGuide}/`} class="inline-flex items-center text-body-sm text-primary-text hover:underline">
              Lees de volledige gids &rarr;
            </a>
          </div>
        )}
      </div>
    </Section>
  </main>
</BaseLayout>
